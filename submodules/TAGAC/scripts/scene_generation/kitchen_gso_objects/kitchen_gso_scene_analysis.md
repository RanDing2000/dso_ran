# Kitchen GSO Scene Generation Analysis

## 脚本概述
`generate_kitchen_dataset_gso_scene.py` 是一个用于生成厨房场景数据集的脚本，主要用于生成包含多个物体的杂乱场景，用于机器人抓取任务的数据集。

## 场景数量分析

### 1. 默认场景数量
- **默认生成场景数**: 1000个场景 (`--num-scenes` 默认值)
- **可配置范围**: 通过命令行参数 `--num-scenes` 可以自定义生成场景数量

### 2. 每个场景的物体数量
- **物体数量范围**: 4-10个物体 (随机选择)
- **代码位置**: `object_count = np.random.randint(4, 11)` (第387行)
- **排除平面**: 场景中还有一个平面(ground plane)，物体ID为0

### 3. 场景生成流程
每个场景的生成过程包括：
1. 随机选择4-10个物体
2. 在仿真环境中随机放置这些物体
3. 渲染深度图和分割图
4. 为每个可见的目标物体生成单独的数据

## 场景类型和配置

### 1. 场景类型
- **pile**: 杂乱堆放场景 (默认)
- **packed**: 紧密排列场景
- 通过 `--scene` 参数选择

### 2. 物体集配置
- **默认物体集**: `mess_kitchen/train`
- **物体来源**: Google Scanned Objects (GSO) 厨房物体
- **URDF路径**: `data/urdfs/mess_kitchen/train`

### 3. 相机配置
- **固定视角**: 默认使用固定相机位置
- **随机视角**: 可通过 `--random` 参数启用随机相机位置
- **相机参数**:
  - 距离: 2 * sim.size (固定) 或 1.6-2.4 * sim.size (随机)
  - 角度: theta = π/3, phi = -π/2 (固定) 或随机范围

## 输出数据结构

### 1. 主要输出目录
```
{root}/
├── scenes/                    # 场景数据
├── mesh_pose_dict/           # 网格姿态字典
├── test_set/                 # 测试集数据
├── visualizations/           # 可视化文件
│   ├── depth_*.png          # 深度图可视化
│   ├── segmentation_*.png   # 分割图可视化
│   └── raw_data/            # 原始数据
└── g1b_files/               # GLB文件和渲染
    ├── *_combined.glb       # 组合网格文件
    ├── *_metadata.json      # 元数据
    └── renders/             # 渲染图像
```

### 2. 每个场景生成的数据
- **场景ID**: 使用UUID生成唯一标识符
- **深度图**: 单视角深度图像
- **分割图**: 物体分割标签
- **点云数据**: 场景和目标物体的点云
- **网格文件**: 带纹理的GLB格式组合网格
- **渲染图像**: PyVista生成的场景可视化

## 目标物体处理

### 1. 目标选择策略
- 只处理第一个可见的目标物体
- 可见性判断: 通过分割图中的像素数量判断
- 代码位置: `if count_cluttered[target_id] == 0: continue`

### 2. 每个目标生成的数据
- **clutter_id**: `{scene_id}_c_{target_id}`
- **点云数据**: 场景点云、目标点云、场景无目标点云
- **网格数据**: 40分辨率TSDF网格
- **渲染图像**: 目标特定的渲染图像

## 可视化功能

### 1. 默认启用的可视化
- **深度图可视化**: 使用jet颜色映射
- **分割图可视化**: 使用Set3颜色映射
- **原始数据保存**: 深度和分割的numpy数组

### 2. 渲染功能
- **PyVista渲染**: 3D场景可视化
- **GLB导出**: 带原始纹理的3D模型文件
- **元数据**: JSON格式的场景信息

## 性能配置

### 1. 多进程支持
- **默认进程数**: 2 (`--num-proc`)
- **可配置**: 通过命令行参数调整

### 2. 噪声配置
- **默认噪声**: 'norm' (正态分布噪声)
- **可选噪声**: 'norm_0.005', 'dex'
- **当前状态**: 噪声功能被注释掉

## 使用示例

### 1. 基本使用
```bash
python generate_kitchen_dataset_gso_scene.py
```

### 2. 自定义场景数量
```bash
python generate_kitchen_dataset_gso_scene.py --num-scenes 100
```

### 3. 禁用可视化
```bash
python generate_kitchen_dataset_gso_scene.py --no-visualization
```

### 4. 使用测试集物体
```bash
python generate_kitchen_dataset_gso_scene.py --object-set mess_kitchen/test
```

## 数据统计总结

### 1. 场景规模
- **总场景数**: 1000 (默认)
- **每场景物体数**: 4-10个
- **总物体数**: 约4000-10000个物体实例

### 2. 数据量估算
- **深度图**: 1000张 (1024x768分辨率)
- **分割图**: 1000张
- **点云数据**: 1000个场景点云 + 1000个目标点云
- **GLB文件**: 1000个组合网格文件
- **渲染图像**: 1000张场景渲染图

### 3. 存储需求
- **深度图**: ~2.3MB/张 × 1000 = ~2.3GB
- **分割图**: ~2.3MB/张 × 1000 = ~2.3GB
- **点云数据**: ~1-5MB/场景 × 1000 = ~1-5GB
- **GLB文件**: ~10-50MB/文件 × 1000 = ~10-50GB
- **总计**: 约15-60GB (取决于物体复杂度和纹理)

## 注意事项

### 1. 依赖要求
- PyVista (可选，用于3D渲染)
- ptvis (可选，用于可视化)
- trimesh (必需，用于网格处理)
- Open3D (必需，用于点云处理)

### 2. 性能考虑
- 生成1000个场景可能需要数小时
- GLB文件生成比较耗时
- 建议使用SSD存储以提高I/O性能

### 3. 内存使用
- 每个场景处理需要数百MB内存
- 建议有8GB+可用内存

## 扩展建议

### 1. 数据增强
- 启用噪声功能
- 添加更多相机视角
- 增加物体数量变化

### 2. 质量控制
- 添加场景质量检查
- 过滤掉过于简单或复杂的场景
- 确保目标物体的可见性

### 3. 并行优化
- 增加多进程数量
- 使用GPU加速渲染
- 优化文件I/O操作
